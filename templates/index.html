<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Utilities</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>

    <div class="container">
        <h1>PDF Utilities</h1>

        <!-- Count Pages Section -->
        <div class="form-container">
            <h3>Count Pages</h3>
            <input type="file" id="count-pages-file" class="file-input" />
            <button class="btn" onclick="countPages()">Count Pages</button>
            <div id="page-count-result" class="result"></div>
        </div>

        <!-- Rotate Pages Section -->
        <div class="form-container">
            <h3>Rotate Pages</h3>
            <input type="file" id="rotate-pages-file" class="file-input" />
            <input type="text" id="pages-to-rotate" class="input-field" placeholder="Pages to rotate (comma-separated)" />
            <input type="number" id="rotation-degree" class="input-field" placeholder="Rotation degree (90, 180, 270)" />
            <button class="btn" onclick="rotatePages()">Rotate Pages</button>
            <div id="rotate-result" class="result"></div>
        </div>

        <!-- Merge PDFs Section -->
        <div class="form-container">
            <h3>Merge PDFs</h3>
            <input type="file" id="merge-pdfs-file" class="file-input" multiple />
            <input type="text" id="output-filename" class="input-field" placeholder="Output Filename" />
            <button class="btn" onclick="mergePdfs()">Merge PDFs</button>
            <div id="merge-result" class="result"></div>
        </div>
    </div>

    <script>
        // Function to handle counting pages
        function countPages() {
            const file = document.getElementById('count-pages-file').files[0];
            if (!file) return alert("Please select a PDF file");

            const formData = new FormData();
            formData.append("pdf_file", file);

            $.ajax({
                url: "/count_pages",
                type: "POST",
                data: formData,
                contentType: false,
                processData: false,
                success: function(response) {
                    $('#page-count-result').html(response);
                },
                error: function(error) {
                    console.log(error);
                }
            });
        }

        // Function to handle rotating pages
        function rotatePages() {
            const file = document.getElementById('rotate-pages-file').files[0];
            const pagesToRotate = document.getElementById('pages-to-rotate').value;
            const rotationDegree = document.getElementById('rotation-degree').value;

            if (!file || !pagesToRotate || !rotationDegree) {
                return alert("Please fill in all fields");
            }

            const formData = new FormData();
            formData.append("pdf_file", file);
            formData.append("pages_to_rotate", pagesToRotate);
            formData.append("rotation_degree", rotationDegree);

            $.ajax({
                url: "/rotate_pages",
                type: "POST",
                data: formData,
                contentType: false,
                processData: false,
                success: function(response) {
                    $('#rotate-result').html('<a href="' + response + '" download="rotated_output.pdf">Download Rotated PDF</a>');
                },
                error: function(error) {
                    console.log(error);
                }
            });
        }

        // Function to handle merging PDFs
        function mergePdfs() {
            const files = document.getElementById('merge-pdfs-file').files;
            const outputFilename = document.getElementById('output-filename').value;

            if (files.length < 2 || !outputFilename) {
                return alert("Please select at least two files and provide an output filename");
            }

            const formData = new FormData();
            for (let i = 0; i < files.length; i++) {
                formData.append('pdf_files', files[i]);
            }
            formData.append('output_filename', outputFilename);

            $.ajax({
                url: "/merge_pdfs",
                type: "POST",
                data: formData,
                contentType: false,
                processData: false,
                success: function(response) {
                    $('#merge-result').html('<a href="' + response + '" download="' + outputFilename + '">Download Merged PDF</a>');
                },
                error: function(error) {
                    console.log(error);
                }
            });
        }
    </script>

</body>
</html>
